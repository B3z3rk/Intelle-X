<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Document Viewer</title>
  
</head>
<body>
  <div id="pdf-container"></div>
  <div id="txt-container" style="display:none;"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.4.456/pdf.min.js"></script>
  <script>
    // Get the filename passed from Flask
    const filename = "{{ filename }}";
    const container = document.getElementById("pdf-container");
    const txtContainer = document.getElementById("txt-container");
    const url = "/uploads/" + filename;

    // showPDF
    const renderPDF = (pdf) => {
      const numPages = pdf.numPages;

      // Loop through each page of the PDF
      for (let pageNum = 1; pageNum <= numPages; pageNum++) {
        pdf.getPage(pageNum).then(page => {
          const scale = 1.5;
          const viewport = page.getViewport({ scale });

          const canvas = document.createElement("canvas");
          const context = canvas.getContext("2d");
          canvas.height = viewport.height;
          canvas.width = viewport.width;
          container.appendChild(canvas);

          const renderContext = { canvasContext: context, viewport };
          page.render(renderContext);
        });
      }
    };

    //show txt
    const renderTXT = () => {
      fetch(url)
        .then(response => response.text())
        .then(text => {
          txtContainer.style.display = 'block'; // Show the text container
          txtContainer.textContent = text;
        });
    };

    // Check the file extension
    if (filename.endsWith(".pdf")) {
      // show PDF
      const loadingTask = pdfjsLib.getDocument(url);
      loadingTask.promise.then(pdf => {
        renderPDF(pdf);
      });
    } else if (filename.endsWith(".txt")) {
      // show TXT file
      renderTXT();
    }
  </script>
</body>
</html>
